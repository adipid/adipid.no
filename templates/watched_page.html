{% extends "base/base.html" %}

{% block head %}
  {% set title = page.title ~ " - " ~ config.title %}
  {% set description = page.description | default(value=config.description) %}
{% endblock head %}

{% block content %}
{% set release_year = page.taxonomies.release_year[0] %}
<article
  class="post h-entry"
  itemscope
  itemtype="http://schema.org/BlogPosting"
>
  <div class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">
      <a href="{{ page.permalink }}">
        {{ page.title | safe }} ({{ release_year }})
      </a>
    </h1>
    <span class="post-meta">
      {%- if config.extra.author -%}
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"
        ><span class="p-author h-card" itemprop="name"
          >{{ config.extra.author }}</span
        ></span
      >
      {%- endif -%}
      <time
        class="dt-published"
        datetime="{{ page.date }}"
        itemprop="datePublished"
      >
        Watched {{ page.extra.date | date(format=config.extra.date_format) }}
      </time>
      {% if page.updated %}
        <time
          class="dt-updated"
          datetime="{{ page.updated }}"
          itemprop="dateUpdated"
        >
          (Updated {{ page.updated | date(format=config.extra.date_format__updated) }})
        </time>
      {% endif %}
      {% if page.taxonomies.genres %}
        <ul class="tags">
          {% set genres = page.taxonomies.genres | sort %}
          {% for genre in genres %}
            <li class="tags__tag">
              <a href="{{ get_taxonomy_url(kind="genres", name=genre) }}">{{ genre }}</a>
            </li>
        {% endfor %}
        </ul>
      {% endif %}
    </span>
  </div>

  <div class="post-content e-content" itemprop="articleBody">
    <dl>
      <dt>Release year</dt>
      <dd>
        <a href="{{ get_taxonomy_url(kind="release_year", name=release_year) }}">{{ release_year }}</a>
      </dd>
      <dt>Director</dt>
      <dd>
        {% for director in page.taxonomies.director %}
          <a href="{{ get_taxonomy_url(kind="director", name=director) }}">{{ director }}</a>
        {% endfor %}
      </dd>
      <dt>My rating</dt>
      <dd>
        {% set rating = page.taxonomies.my_rating[0] | int %}
        {% set rating_total = 5 %}
        {% set rating_diff = rating_total - rating %}
        <a href="{{ get_taxonomy_url(kind="my_rating", name=page.taxonomies.my_rating[0]) }}" aria-label="Movie's rating">
          {% for star in range(end=rating) %}★{% endfor %}{% for star in range(end=rating_diff) %}☆{% endfor %}
        </a>
      </dd>
    </dl>
    {{ page.content | safe }}
  </div>

  {% set earlier = page.earlier %}
  {% set later = page.later %}
  <nav class="pagination post">
      {% if later %}
          <a class="newer" href="{{ later.permalink }}">
            <span class="pagination__label">
              ‹ Newer post
            </span>
            <span class="pagination__title">
              {{ later.title }}
            </span>
          </a>
      {% endif %}
      {% if earlier %}
          <a class="older" href="{{ earlier.permalink }}">
            <span class="pagination__label">
              Older post ›
            </span>
            <span class="pagination__title">
              {{ earlier.title }}
            </span>
          </a>
      {% endif %}
  </nav>

  <a class="u-url" href="{{ page.permalink | safe }}" hidden></a>
</article>

{% endblock content %}

