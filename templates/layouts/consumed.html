{% extends "base/base.html" %}

{% block head %}
  {% if section %}
    {% set title = section.title ~ " - " ~ config.title %}
    {% set description = section.description | default(value=config.description) %}
    {% if section.updated %}
      {% set updated = section.updated | date(format=config.extra.date_format) %}
    {% endif %}
    {% if section.content %}
      {% set content = section.content %}
    {% endif %}
  {% endif %}
{% endblock head %}

{% block content %}

<section class="page-content page-review">
  <h1 class="page-title">{{ section.title | default(value=page.title) }}</h1>
  {% if content %}
    {{ content | safe }}
  {% endif %}
  <div class="entries">
  {% for entry in section.pages | sort(attribute="extra.date") | reverse %}
    {% set date = entry.extra.date %}
    {% if entry.taxonomies.consumed_type[0] == "movie" or entry.taxonomies.consumed_type[0] == "tv" %}
      {% if entry.extra.rewatched %}
        {% set date = entry.extra.rewatched | last %}
        {% set rewatched = true %}
      {% endif %}
    {% endif %}
    {% if entry.extra.reviewed %}
      <div aria-label="Entry title">
        <a href="{{ entry.path }}">
          {{ entry.title }}
        </a>
      </div>
    {% else %}
      <div aria-label="Entry title">{{ entry.title }}</div>
    {% endif %}
    {% if entry.taxonomies.tv_creator %}
      <div aria-label="Entry creator(s)">
        {% for creator in entry.taxonomies.tv_creator %}
          {{ creator }}{% if not loop.last %},{% endif %}
        {% endfor %}
      </div>
    {% elif entry.taxonomies.director %}
      <div aria-label="Entry director(s)">
        {% for director in entry.taxonomies.director %}
          {{ director }}{% if not loop.last %},{% endif %}
        {% endfor %}
      </div>
    {% else %}
      <div aria-label="Entry author">
        {% for author in entry.taxonomies.book_author %}
          {{ author }}{% if not loop.last %},{% endif %}
        {% endfor %}
      </div>
    {% endif %}
      <time aria-label="When entry was watched">{% if date %}{{ date }} {% if rewatched %}(R){% endif %}{% endif %}</time>
    {% set rating = entry.taxonomies.my_rating[0] | int %}
    {% set rating_total = 5 %}
    {% set rating_diff = rating_total - rating %}
    <div aria-label="Entry rating">{% for star in range(end=rating) %}★{% endfor %}{% for star in range(end=rating_diff) %}☆{% endfor %}</div>
  {% endfor %}
  </div>
  <div class="count">
    Count: {{ section.pages|length }}
  </div>
</section>

{% endblock content %}

