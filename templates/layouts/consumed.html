{% extends "base/base.html" %}

{% block head %}
  {% if section %}
    {% set title = section.title ~ " - " ~ config.title %}
    {% set description = section.description | default(value=config.description) %}
    {% if section.updated %}
      {% set updated = section.updated | date(format=config.extra.date_format) %}
    {% endif %}
    {% if section.content %}
      {% set content = section.content %}
    {% endif %}
  {% endif %}
{% endblock head %}

{% block content %}

{% set files = section.extra.json_files %}
{% set person_field = section.extra.person_field %}
{% set date_field = section.extra.date_field %}
{% set is_date_field_array = section.extra.date_field_is_array %}

<section class="page-content page-review">
  <h1 class="page-title">{{ section.title | default(value=page.title) }}</h1>
  {% if content %}
    {{ content | safe }}
  {% endif %}
  {% if files|length > 1 %}
    {% set_global array = [] %}
    {% for file in files %}
      {% set loaded_file = load_data(path=file) %}
      {% set_global array = array | concat(with=loaded_file) %}
    {% endfor %}
  {% else %}
    {% set array = load_data(path=files[0]) %}
  {% endif %}
  <div class="entries">
  {% for entry in array | sort(attribute=date_field) | reverse %}
    {% set date = entry[date_field] %}
    <div aria-label="Entry title">{{ entry.title }}</div>
    {% for field in person_field %}
      {% if entry[field] %}
        <div aria-label="Entry {{ field }}{{ entry[field]|length | pluralize }}">
          {% for person in entry[field] %}
            {{ person }}{% if not loop.last %},{% endif %}
          {% endfor %}
        </div>
      {% endif %}
    {% endfor %}
    <time aria-label="When entry was watched">{% if date %}{{ date }}{% endif %}</time>
    {% set rating = entry.my_rating | int %}
    {% set rating_total = 5 %}
    {% set rating_diff = rating_total - rating %}
    <div aria-label="Entry rating">{% for star in range(end=rating) %}★{% endfor %}{% for star in range(end=rating_diff) %}☆{% endfor %}</div>
  {% endfor %}
  </div>
  <div class="count">
    Count: {{ array|length }}
  </div>
</section>

{% endblock content %}

