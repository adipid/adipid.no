{% extends "layouts/page_wrapper.html" %}
{% import "macros.html" as macros %}

{% block page_class %}page-log{% endblock page_class %}

{% block page_content %}

  {% set files = page.extra.json_files %}
  {% set is_date_field_array = page.extra.date_field_is_array %}
  {% set year_field = page.extra.year_field | default(value=false) %}

  {% if content %}
    {{ content | safe }}
  {% endif %}
  {% for file in files %}
    {% set array = load_data(path=file) | sort(attribute="date.0.year") | reverse %}
    {% if array[0].type %}
      <h2>{{ array[0].type | capitalize }}s</h2>
    {% endif %}
    {% for year, entries in array | group_by(attribute="date.0.year") %}
      <div class="log__year">
        <div class="log__year__header">
          {% if year != "0" %}
            <h3>{{ year }}</h3>
          {% else %}
            <h3>Other</h3>
          {% endif %}
          <span>({{ entries | length }} entr{{ entries | length | pluralize(singular="y", plural="ies") }})</span>
        </div>
        <div class="entries">
          {% for entry in entries %}
            <div class="entry">
              <div aria-label="Entry title">
                {{ entry.title }}
                {% if year_field %}
                  ({{ entry[year_field] }})
                {% endif %}
              </div>
              <div aria-label="Entry rating">{{ macros::rating(max=5, rating=entry.details.my_rating) }}</div>
              {% if entry.date.0.string %}
                {% set dateArray = entry.date | sort(attribute="year") | reverse %}
                <time aria-label="When entry was logged">
                  {% if dateArray[0].day and dateArray[0].month %}
                    {{ dateArray[0].string | date(format="%b. %e") }}
                  {% else %}
                    {{ dateArray[0].string }}
                  {% endif %}
                </time>
              {% endif %}
            </div>
          {% endfor %}
        </div>
      </div>
    {% endfor %}
    <div class="count">
      Total count: {{ array | length }}
    </div>
  {% endfor %}
{% endblock page_content %}

